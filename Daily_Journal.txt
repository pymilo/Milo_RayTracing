@Milo

####################################
December 13, 2017 
####################################

The simulation has a bugg we want to fix. It consists in showing linear spatial gaps on the ghost-ray pattern for far
off-axis sources (~20 or ~30 arcmin).

The plan is to look at the cross-section of the incident rays at especific locations along the optical path. e.g.
at the module pupil, at the first hit of every ray.

So far I have tested that cross-section at the front of the optics for an on-axis source. The work was saved in the python3
notebook: "/Source_Debuging_00.ipynb".

Small problem found: The inner blocker has the wrong dimension. An
issue was created in the FOXSI-Github repository and assigned to
myself to fix it once I get the real values from Patrick (Marshall).
Patrick already responded saying he will give me those number early
next week. Fro now we could take some numbers out of the CAD drawings.

####################################
December 14, 2017 
####################################

* Created a notebook called Source_Debuging_01.ipynb that contains
  tests that pass rays through the module and plot the cross-section.
  
####################################
December 15, 2017 
####################################

* I plotted the cross-section of the rays after their first
  bounce - Everything saved in Notebook: Source_Debuging_01.
  Here what I found:

  * For an on-axis at d=100m source, photons hit once in both the
    Paraboloid and the Hyperboloid segment.
  * For an on-axis at d=1AU source, photons hit once only on the
    most inner hyperboloid segment. This is expected since for this
    far away source, the rays come almost in a parallel configuration.
  * The reason I see hyperboloid hits only in the most inner mirror is
    because the rays are not yet killed by the back core blocker.
    I expect that once the rays are collected by the detector,
    i.e. pass through the back blocker, those singly reflected rays
    get killed.
  * From the simulation, paraboloid gost rays appear at smaller
    off-axis angles than those coming from the hyperboloid segment.
  * If theta is the polar angle, paraboloid ghost rays initially come
    from theta ~ 0 and 180 degress. Then the move down once the
    off-axis increases. This is true for an off-axis source located on
    the negative region of the Y-axis.
  * Some ghost rays coming from the hyperboloid segment start
    appearing for off-axis greater than ~15 arcmin.
  * Whit 10 thousand rays I sort of see some gaps on the singly
    reflected rays coming from the paraboloid. More rays are needed to
    convince myself that the gaps are indeed there.
  * I run one million photons at the end of the notebook. It took a
    while, so I figured I might be better to use the rays already
    saved in CSV files to make this kind of plots and that is exactly
    what I'll do next.

####################################
December 19, 2017 
####################################

  * Tryed to save the rays using the  foxsisim.util "save_rays"
    function, but after running 10e7 rays I did not have success
    saving the rays for a bug related with the history parameter of
    the rays. This cost me 4 hours of having the computer running with
    no succes. Save_rays shows some troubles when the rays are more
    than 40 off-axis for some reason. Further exploration is needed.

  * I expended most of my time debugging the HPD function of the
    Optics calibration.

####################################
December 20, 2017 
####################################

   * Hunting down the save_rays problem. I found that the problem was
     that the passthorugh rays (those that don't interact with the
     module) don't have a hist parameter with dimension greater than
     2, so the program was breaking. I easily solved the problem by
     sieving the rays and eliminating those that pass thorugh.
   * We have passthrough rays at this point because the back blocker
     hasn't been introduced. It is introduce with the function
     Detector.CatchRays.

####################################
December 21, 2017 
####################################

    * There is a big difference on the angular distribution observed
      for 30arcmin off-axis sources between Notebooks
      Source_Debuging_01 and Source_Debuging_02. The main difference
      is that the first is plotted using Rays that Pass Thorugh the
      module and no more. The second plots the rays that in addition
      to pass thorugh the module have been caught by the detector. I
      suspect the assimetry may be related with the way the detector
      catches rays.
    * To asses this difference I run rays at 30arcmin off-axis and
      saved them on '1millionRays/rays_on_module.csv'
    * These differences are compared on Notebook: Source_Debuging_03








   





















